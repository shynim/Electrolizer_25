from flask import Flask, request
import subprocess
from flask_cors import CORS

student_data = {
    "24": "94713727039",
    "7": "94768054934",
    "10": "94777201047",
    "13": "94761353725",
    "18": "94741156577",
    "20": "94704301110",
    "27": "94704454151",
    "28": "94771586939",
    "31": "94706077747",
    "37": "94710106066",
    "38": "94711154356",
    "39": "94715144990",
    "48": "94761058982",
    "52": "94714907137",
    "53": "94716259900",
    "56": "94774877396",
    "62": "94753351262",
    "64": "94741481230",
    "65": "94768451858",
    "68": "94769151353",
    "69": "94703122294",
    "71": "94765500153",
    "80": "94741063262",
    "85": "94722778430",
    "87": "94761324156",
    "113": "94788918201",
    "114": "94783875273",
    "119": "94703422883",
    "124": "94703629897",
    "128": "94741944874",
    "135": "94716958182",
    "138": "94701897436",
    "145": "94774510282",
    "150": "94703382899",
    "151": "94768039250",
    "158": "94778429249",
    "166": "94762634275",
    "171": "94771801759",
    "172": "94703320847",
    "181": "94704903356",
    "183": "94774487029",
    "190": "94779449383",
    "192": "94762179938",
    "198": "94779168343",
    "200": "94765424356",
    "213": "94762331914",
    "215": "94763362042",
    "217": "94705381965",
    "219": "94775259968",
    "222": "94760133403",
    "227": "94712574022",
    "233": "94712143127",
    "235": "94770331929",
    "241": "94770167199",
    "246": "94771669310",
    "248": "94713450214",
    "251": "94767524717",
    "252": "94777822171",
    "259": "94777753996",
    "262": "94702750824",
    "267": "94712800921",
    "269": "94750816535",
    "278": "94755641186",
    "279": "94769867116",
    "287": "94702097030",
    "305": "94757014431",
    "314": "94772918839",
    "315": "94722025313",
    "320": "94767200210",
    "329": "94774365410",
    "331": "94751380934",
    "337": "94785879842",
    "339": "94701994686",
    "344": "94704606886",
    "364": "94754787781",
    "365": "94715901044",
    "368": "94755350299",
    "380": "94761144314",
    "386": "94776524675",
    "388": "94761231495",
    "389": "94719337596",
    "397": "94702847963",
    "398": "94771427225",
    "399": "94763215057",
    "400": "94751567059",
    "401": "94760735873",
    "402": "94760048093",
    "405": "94787743731",
    "406": "94714002058",
    "413": "94761641275",
    "415": "94761683675",
    "422": "94713615024",
    "433": "94719115963",
    "441": "94702527913",
    "443": "94702971042",
    "446": "94702855954",
    "449": "94762985822",
    "452": "94703554160",
    "453": "94766311385"
}

student_info = {
    "7": {"name": "Mohamed Ahmadh", "photo_url": "/7.png"},
    "10": {"name": "Sivaharan Aksaraan", "photo_url": "/10.png"},
    "13": {"name": "Nimashi Amarathunga", "photo_url": "/13.png"},
    "18": {"name": "Dimantha Ariyawansa", "photo_url": "/18.png"},
    "20": {"name": "Arunothayan", "photo_url": "/20.png"},
    "24": {"name": "Kulaja", "photo_url": "/24.png"},
    "27": {"name": "Sandaruwan Bandara", "photo_url": "/27.png"},
    "28": {"name": "Pasindu Bandara", "photo_url": "/28.png"},
    "31": {"name": "Pamod Bandara", "photo_url": "/31.png"},
    "37": {"name": "Sachin Bandara", "photo_url": "/37.png"},
    "38": {"name": "Osanda Bandaranayake", "photo_url": "/38.png"},
    "39": {"name": "Senuda Batawala", "photo_url": "/39.PNG"},
    "48": {"name": "Githmal Chavishka", "photo_url": "/48.PNG"},
    "52": {"name": "Darshan", "photo_url": "/52.PNG"},
    "53": {"name": "Anjula Dasanayaka", "photo_url": "/53.PNG"},
    "56": {"name": "Sahanya De Silva", "photo_url": "/56.PNG"},
    "62": {"name": "Vihanga Deemantha", "photo_url": "/62.PNG"},
    "64": {"name": "Madusha Deshan", "photo_url": "/64.PNG"},
    "65": {"name": "Madhuka Deshappriya", "photo_url": "/65.PNG"},
    "68": {"name": "Malindu Devindu", "photo_url": "/68.PNG"},
    "69": {"name": "Randil Dharmarathna", "photo_url": "/69.PNG"},
    "71": {"name": "Mathisha Dilanki", "photo_url": "/71.PNG"},
    "80": {"name": "Vipun Dissanayaka", "photo_url": "/80.png"},
    "85": {"name": "Pasindu Dissanayake", "photo_url": "/85.PNG"},
    "87": {"name": "Vidasni Dulanma", "photo_url": "/87.PNG"},
    "113": {"name": "Amila Sampath", "photo_url": "/113.PNG"},
    "114": {"name": "Yasitha Gunasekara", "photo_url": "/114.PNG"},
    "119": {"name": "Dimuth Gunawardhana", "photo_url": "/119.PNG"},
    "124": {"name": "Sandeepa Gurunayake", "photo_url": "/124.PNG"},
    "128": {"name": "Sehansa Herath", "photo_url": "/128.PNG"},
    "135": {"name": "Buddhi Illankoon", "photo_url": "/135.PNG"},
    "138": {"name": "Isiwari Isiwari", "photo_url": "/138.PNG"},
    "145": {"name": "Udesha Jayasekara", "photo_url": "/145.PNG"},
    "150": {"name": "Gihan Jayasiri", "photo_url": "/150.PNG"},
    "151": {"name": "Dulan Jayasooriya", "photo_url": "/151.PNG"},
    "158": {"name": "Kalhara", "photo_url": "/158.PNG"},
    "166": {"name": "Sasindu Kariyawasam", "photo_url": "/166.PNG"},
    "171": {"name": "Sihath Kasiwatta", "photo_url": "/171.PNG"},
    "172": {"name": "Kasthuri", "photo_url": "/172.PNG"},
    "181": {"name": "Hasini Kulasinghe", "photo_url": "/181.PNG"},
    "183": {"name": "Denura Kulawansha", "photo_url": "/183.PNG"},
    "190": {"name": "Rashmi Kumari", "photo_url": "/190.png"},
    "192": {"name": "Sasindu Emesha", "photo_url": "/192.PNG"},
    "198": {"name": "Damindu Lathhara", "photo_url": "/198.png"},
    "200": {"name": "Damketh", "photo_url": "/200.PNG"},
    "213": {"name": "Sahan Maduranga", "photo_url": "/213.png"},
    "215": {"name": "Shanil Madusanka", "photo_url": "/215.png"},
    "217": {"name": "Tharaka Mahanama", "photo_url": "/217.PNG"},
    "219": {"name": "Aveesha Manchanayaka", "photo_url": "/219.PNG"},
    "222": {"name": "Tanusha Manuranga", "photo_url": "/222.PNG"},
    "227": {"name": "Ravindu Methsara", "photo_url": "/227.PNG"},
    "233": {"name": "Wihandu Munasinghe", "photo_url": "/233.PNG"},
    "235": {"name": "Nithil Nanayakkara", "photo_url": "/235.PNG"},
    "241": {"name": "Dilumi Nawarathna", "photo_url": "/241.PNG"},
    "246": {"name": "Thisanda Ninduwara", "photo_url": "/246.PNG"},
    "248": {"name": "Rashmi Nisansala", "photo_url": "/248.PNG"},
    "251": {"name": "Rusith Pahasara", "photo_url": "/251.PNG"},
    "252": {"name": "Pasindu Pahasara", "photo_url": "/252.jpg"},
    "259": {"name": "Darusha Peiris", "photo_url": "/259.jpg"},
    "262": {"name": "Isuri Peiris", "photo_url": "/262.jpg"},
    "267": {"name": "Imalka Perera", "photo_url": "/267.jpg"},
    "269": {"name": "Chamindu Perera", "photo_url": "/269.jpg"},
    "278": {"name": "Pramodya Lahiru", "photo_url": "/278.jpg"},
    "279": {"name": "Nirmal Premasiri", "photo_url": "/279.jpg"},
    "287": {"name": "Upethna Rajapaksha", "photo_url": "/287.jpg"},
    "305": {"name": "Janudha Ransitha", "photo_url": "/305.jpg"},
    "314": {"name": "Banula Rathnayake", "photo_url": "/314.jpg"},
    "315": {"name": "Ishan Rathnayake", "photo_url": "/315.jpg"},
    "320": {"name": "Dinidu Rodrigo", "photo_url": "/320.jpg"},
    "329": {"name": "Sahan", "photo_url": "/329.jpg"},
    "331": {"name": "Akshan Sahi", "photo_url": "/331.jpg"},
    "337": {"name": "Mathisha Samaranayake", "photo_url": "/337.jpg"},
    "339": {"name": "Navodya Samarasinghe", "photo_url": "/339.jpg"},
    "344": {"name": "Sammani", "photo_url": "/344.jpg"},
    "354": {"name": "Danindu Jayasuriya", "photo_url": "/354.jpg"},
    "364": {"name": "Roshen Senanayaka", "photo_url": "/364.png"},
    "365": {"name": "Thisaree Senanayake", "photo_url": "/365.jpg"},
    "368": {"name": "Sandesha Senaratne", "photo_url": "/368.jpg"},
    "380": {"name": "Dulran Silva", "photo_url": "/380.jpg"},
    "386": {"name": "Windi Sooriyaarachchi", "photo_url": "/386.jpg"},
    "388": {"name": "Stalan Stalanraj", "photo_url": "/388.jpg"},
    "389": {"name": "Pehasarani", "photo_url": "/389.jpg"},
    "397": {"name": "Tharupiyum", "photo_url": "/397.png"},
    "398": {"name": "Sithum Thenuka", "photo_url": "/398.png"},
    "399": {"name": "Isurika Thilakarathne", "photo_url": "/399.jpg"},
    "400": {"name": "Harindu Thilakasiri", "photo_url": "/400.jpg"},
    "401": {"name": "Priyanthi", "photo_url": "/401.jpg"},
    "402": {"name": "Kethmi Thirandi", "photo_url": "/402.jpg"},
    "405": {"name": "Amanda Udawaththa", "photo_url": "/405.jpg"},
    "406": {"name": "Mohamed Umair", "photo_url": "/406.jpg"},
    "413": {"name": "Udantha Vilochana", "photo_url": "/413.jpg"},
    "415": {"name": "Vishal", "photo_url": "/415.jpg"},
    "422": {"name": "Dinali Warnathara", "photo_url": "/422.jpg"},
    "433": {"name": "Matheesha", "photo_url": "/433.png"},
    "441": {"name": "Malsha Wijerathna", "photo_url": "/441.png"},
    "443": {"name": "Bihandu Wijesekara", "photo_url": "/443.png"},
    "446": {"name": "Subhashana", "photo_url": "/446.png"},
    "449": {"name": "Mahesha Wijethunga", "photo_url": "/449.png"},
    "452": {"name": "Anumi Withanage", "photo_url": "/452.png"},
    "453": {"name": "Ashen Yalagama", "photo_url": "/453.png"}
}

app = Flask(__name__)
CORS(app)  # Allow React frontend to talk to Flask backend

@app.route('/qr-scan', methods=['POST'])
def handle_qr_scan():
    data = request.get_json()
    student_id = data.get('studentId')
    print("Received student ID:", student_id)

    if not student_id:
        return {'status': 'error', 'message': 'Missing studentId'}, 400

    try:
        # Run your custom terminal command
        result = subprocess.run(
            print("Sending message"),
            ['npx', 'mudslide', 'send', student_data[student_id], "Welcome "+student_info[student_id]['name']],
            ['npx', 'mudslide', 'send', student_data[student_id], student_info[student_id]['photo_url']],
            print("Done"),
            capture_output=True,
            text=True
        )

        return {'status': 'success', 'output': result.stdout.strip()}, 200
    except Exception as e:
        return {'status': 'error', 'message': str(e)}, 500

if __name__ == '__main__':
    app.run(port=5000)